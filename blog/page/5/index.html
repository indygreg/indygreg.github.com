


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
Design by Free CSS Templates
http://www.freecsstemplates.org
Released for free under a Creative Commons Attribution 2.5 License

Name       : Pollinating  
Description: A two-column, fixed-width design with dark color scheme.
Version    : 1.0
Released   : 20101114

-->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    
  <title>Gregory Szorc's Digital Home
</title>
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
<link rel="alternate" type="application/atom+xml" title="Atom 1.0"
href="/blog/feed/atom" />
<link rel="stylesheet" href="/style/style.css" type="text/css" />
<link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />


  </head>
  <body>
    <div id="wrapper">
      
  <div id="menu">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/notes">Notes</a></li>
    <li><a href="/work.html">Work</a></li>
    <li><a href="/skills.html">Skills</a></li>
    <li><a href="/thoughts.html">Thoughts</a></li>
    <li><a href="/resume.pdf">Resume</a></li>
  </ul>
</div>


      <div id="page">
        <div id="page-bgtop">
          <div id="page-bgbtm">
              <div id="content">
                
  
<div class="blog_post">
  <a name="why-firefox-builds-are-slow"></a>
  <h2 class="blog_post_title"><a href="/blog/2013/10/01/why-firefox-builds-are-slow" rel="bookmark" title="Permanent Link to Why Firefox builds are slow">Why Firefox builds are slow</a></h2>
  <small>October 01, 2013 at 01:30 AM | categories: 

<a href='/blog/category/mozilla'>Mozilla</a>
 | <a href="http://gregoryszorc.com/blog/2013/10/01/why-firefox-builds-are-slow#disqus_thread">View Comments</a>
</small><p/>
  <div class="post_prose">
    
  <p>Many people ask/complain about Firefox builds being slow. They are slow.
You have every right to complain.</p>
<p>Now in the <a href="https://ci.mozilla.org/job/mozilla-central-docs/Build_Documentation/index.html">official build system docs</a>
is a <a href="https://ci.mozilla.org/job/mozilla-central-docs/Build_Documentation/slow.html">page</a>
explaining the major reasons why the build system is slow. I encourage
everyone to read it. If you have any questions, ping me and I'll update
the docs.</p>
<p>Not yet documented there are some new insights we've been getting from
Mike Hommey's <a href="https://groups.google.com/d/msg/mozilla.dev.platform/4dp9WTQ6F60/9ypVOMk55zkJ">terrific work</a>
to optimize how make traversal works in the current build system.</p>
<p>As part of that work, Mike established a new <em>compile</em> tier in the build
system. This tier compiles C/C++ and little else. Before, C/C++
compiling was interleaved with all the other build steps (install JS
files, xpt processing, etc), so it was somewhat difficult to isolate the
impact of compilation against all other build actions.</p>
<p>Now that we have all compiling happening in one isolated phase, it's pretty
obvious that compiling accounts for the majority of CPU and wall time in
the build system (at least with non no-op builds). We suspected this
before, but we didn't have concrete numbers.</p>
<p>As I've been pulling and rebuilding inbound since this change landed,
it's become increasing clear to me the impact of header dependency hell
on build times. Even simple changesets touching a few .h files are
resulting in hundreds or even thousands of C/C++ files being recompiled.
This increases incremental build times from say 1.5 minutes to often
over 10 minutes.</p>
<p>With Mike Hommey's work, I feel we finally are on a path to make no-op
build times reasonable for many developers. However, until the header
dependency graph is significantly reduced, developers will continue to
see excessively long build times for incremental builds, especially on
pulls. (I notice that my daily inbound pulls take about as long as a
clobber build, which means practically every .cpp file is invalidated
every day due to .h changes.)</p>
<p>Fortunately, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=785103">great work</a>
has been happening to minimize C/C++ header dependency hell recently.
To everyone working on that, everyone who builds Firefox owes you a
giant <strong>thank you</strong>. However, there's much more that can be done. While
you've made terrific progress, please don't slow down any time soon.</p>

  </div>
</div>



  <div class="after_post"><a href="http://gregoryszorc.com/blog/2013/10/01/why-firefox-builds-are-slow#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  
<div class="blog_post">
  <a name="important-ubuntu-bootstrap-update"></a>
  <h2 class="blog_post_title"><a href="/blog/2013/09/12/important-ubuntu-bootstrap-update" rel="bookmark" title="Permanent Link to Important Ubuntu bootstrap update">Important Ubuntu bootstrap update</a></h2>
  <small>September 12, 2013 at 09:35 AM | categories: 

<a href='/blog/category/mozilla'>Mozilla</a>
 | <a href="http://gregoryszorc.com/blog/2013/09/12/important-ubuntu-bootstrap-update#disqus_thread">View Comments</a>
</small><p/>
  <div class="post_prose">
    
  <p>Do you run Ubuntu and build Firefox? If so, please check out a
mozilla-central revision as of a few hours ago and run <strong>mach
bootstrap</strong>. Among other things, the bootstrapper now installs a modern
version of Mercurial (2.7 at the time I wrote this). Ubuntu currently
ships 2.2.2 in 12.10 and 13.04. It's even worse for older releases.
Mercurial has evolved a lot over the last few months and releases and
I don't think you'll be disappointed after upgrading.</p>
<p>If you don't run Ubuntu, you should still run <strong>mach bootstrap</strong>
periodically to ensure your system has the optimal packages for
developing Firefox.</p>

  </div>
</div>



  <div class="after_post"><a href="http://gregoryszorc.com/blog/2013/09/12/important-ubuntu-bootstrap-update#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  
<div class="blog_post">
  <a name="hosting-mozilla-services-with-stackato"></a>
  <h2 class="blog_post_title"><a href="/blog/2013/09/04/hosting-mozilla-services-with-stackato" rel="bookmark" title="Permanent Link to Hosting Mozilla services with Stackato">Hosting Mozilla services with Stackato</a></h2>
  <small>September 04, 2013 at 03:07 PM | categories: 

<a href='/blog/category/mozilla'>Mozilla</a>
 | <a href="http://gregoryszorc.com/blog/2013/09/04/hosting-mozilla-services-with-stackato#disqus_thread">View Comments</a>
</small><p/>
  <div class="post_prose">
    
  <p>Many people have written custom web services related to Mozilla
projects. Cool! However, many of these services live on random hosts
scattered around the internets. These hosts can have frequent downtime,
cost Mozilla contributors time and money to operate, and can be hard to
discover and trust (I don't want to give my LDAP credentials to a
non-Mozilla server).</p>
<p>Did you know Mozilla operates a Platform-as-a-Service (PaaS)
infrastructure that allows Mozillians to host web services and daemons
on the internets (similar to how EC2 works). Until recently, I didn't
either!</p>
<p>If you are a Mozilla employee, learn more about
<a href="https://mana.mozilla.org/wiki/display/websites/paas.allizom.org">paas.allizom.org</a>.
(To non-employees, unfortunately it appears you can't use this yet. And
I'm not sure what the plans for that are.)</p>
<p>This service is actually a Mozilla-hosted <a href="http://www.activestate.com/stackato">Stackato</a>
instance. You set up your client with your LDAP credentials, provision
services such as PostgreSQL, memcache, MySQL, etc and deploy
applications - either web applications or standalone daemons. The
runtime environment supports nearly everything under the sun - Python,
Node.js, Ruby, Perl, PHP, Java, etc. You write an application, drop a
few files in the project to describe how to deploy it to Stackato, push
it, and <em>it just works.</em> Web applications even get an HTTPS endpoint
with a valid root CA chained certificate!</p>
<p>I recently used this service to power my Django-based
<a href="https://hg.mozilla.org/users/gszorc_mozilla.com/automation-dashboard/">automation-dashboard</a>
project. Aside from the initial hurdles figuring out how Django works
(this was the first Django project I've written) and how to hook Django
up to Stackato, I'm pretty impressed with the results. Free web hosting
with database access!</p>
<p>For me, the selling point of this service is that apparently the
transition plan from Stackato-hosted service to IT-managed service is
relatively pain free. Since you must perform all the steps to
isolate/package your application for Stackato, it's relatively easy for
IT to deploy your application.</p>
<p>I encourage Mozillians to look into using this PaaS service for their
Mozilla service hosting needs.</p>

  </div>
</div>



  <div class="after_post"><a href="http://gregoryszorc.com/blog/2013/09/04/hosting-mozilla-services-with-stackato#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  
<div class="blog_post">
  <a name="visualizing-mozilla's-release-infrastructure-machine-efficiency"></a>
  <h2 class="blog_post_title"><a href="/blog/2013/08/30/visualizing-mozilla's-release-infrastructure-machine-efficiency" rel="bookmark" title="Permanent Link to Visualizing Mozilla's release infrastructure machine efficiency">Visualizing Mozilla's release infrastructure machine efficiency</a></h2>
  <small>August 30, 2013 at 12:30 PM | categories: 

<a href='/blog/category/mozilla'>Mozilla</a>
 | <a href="http://gregoryszorc.com/blog/2013/08/30/visualizing-mozilla's-release-infrastructure-machine-efficiency#disqus_thread">View Comments</a>
</small><p/>
  <div class="post_prose">
    
  <p>Have you ever wondered what the machines in Mozilla's automation
infrastructure are doing all the time? I have. So, I decided to create a
visualization of this data. You can find it at
<a href="http://automation-dashboard.paas.allizom.org/">http://automation-dashboard.paas.allizom.org/</a>.</p>
<p>When you start looking at the visualizations, you notice something:
there's a lot of time when machines aren't doing anything! All that
white space between jobs is time machines are not processing jobs. This
is capacity Mozilla is failing to utilize.</p>
<p>While some may say Mozilla's automation infrastructure has a load or
capacity problem, I say it has an efficiency problem. The average
machine in our automation infrastructure is doing work less than 50% of
the time <em>during weekdays</em>. Now, some of this might be VMs that are
powered off (due to low demand). But considering physical machines are
also under-utilized, I'd say it's a global problem.</p>
<p>Oh, and don't get too hung up with a machine-job efficiency metric.
While important, it's only part of the problem. When jobs are running,
they are typically only using a fraction of the CPU available to them.
From data <a href="/blog/2013/07/14/quantifying-mozilla's-automation-efficiency/">now available in mozharness</a>,
we know that many test suites only use 10-15% CPU. If you combine this
with sub-50% machine utilization in terms of jobs, I estimate we're only
utilizing somewhere between 5-10% of available CPU cycles in our automation
infrastructure. We have a magnitude more capacity in the machines we
already have. <strong>We don't have a capacity problem, we have an efficiency
problem.</strong> In my opinion we should throw less time and money at new
hardware and invest in maximizing the return from what we have.</p>
<h2>Edit 2013-09-03</h2>
<p>I started a thread about this data in another forum and others have
pointed out that the data in this post is incomplete. Notably absent
from this data is when on-demand EC2 instances are shut down, when there
are or aren't jobs scheduled (if jobs aren't scheduled, poor machine
utilization isn't such a big deal), and when some maintainence tasks are
performed (e.g. Panda boards are checked for consistency between jobs).
While we could probably hook job scheduling data up to the graph and
numbers easily, I don't believe data on slave <em>uptime</em> or background
tasks is publicly available. Perhaps we should publish this data to
facilitate deeper analysis.</p>
<p>A goal of this post was to shed light on how little we utilize some of
the machines in our automation infrastructure in order to inspire a
conversation and ultimately to address the perceived problem. It was
not a goal to point fingers and cast blame. If I inadvertently
performed the latter or seemed to jump to conclusions based on
incomplete data, I apologize.</p>

  </div>
</div>



  <div class="after_post"><a href="http://gregoryszorc.com/blog/2013/08/30/visualizing-mozilla's-release-infrastructure-machine-efficiency#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  
<div class="blog_post">
  <a name="mercurial-setup-wizard-for-firefox-development"></a>
  <h2 class="blog_post_title"><a href="/blog/2013/07/29/mercurial-setup-wizard-for-firefox-development" rel="bookmark" title="Permanent Link to Mercurial setup wizard for Firefox development">Mercurial setup wizard for Firefox development</a></h2>
  <small>July 29, 2013 at 05:45 PM | categories: 

<a href='/blog/category/mercurial'>Mercurial</a>, <a href='/blog/category/mozilla'>Mozilla</a>
 | <a href="http://gregoryszorc.com/blog/2013/07/29/mercurial-setup-wizard-for-firefox-development#disqus_thread">View Comments</a>
</small><p/>
  <div class="post_prose">
    
  <p>I'm a big fan of tools that encourage and/or enforce the following of
best practices and that help people become more productive.</p>
<p>One of the tools that Firefox developers interact with nearly daily is
Mercurial. As I've observed from coworkers and from community
contributors, many don't have Mercurial configured for optimal
development. For first-time contributors, this can manifest in patch
rejection - an experience that can be embarassing and demotivating. This
is frustrating to me because most issues are easily identifiable and
correctable. And, when addressed, everyone wins.</p>
<p>Anyway, I'm pleased to announce that there is now a configuration wizard
in the Firefox source tree to help with configuring Mercurial. To run it,
just type:</p>
<pre><code>./mach mercurial-setup
</code></pre>
<p>Currently, it's aimed for first-time contributors. So, it's missing
things that more seasoned developers rely on. But you need to start
somewhere, right?</p>
<p>Currently, the tool isn't advertised anywhere other than <em>mach help</em>.
Please run it and report issues in
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=794580">bug 794580</a> or
file a new report. Once things have baked in, I'd like to add some kind
of notification/tips system to mach where it will encourage you to do
things like automatically run <em>mach mercurial-setup</em>. Until then, I
recommend trying to remember to run <em>mach mercurial-setup</em> every few
weeks to ensure your Mercurial environment is up to date and properly
configured.</p>
<p>I'd like to thank Nick Alexander for sharing my enthusiasm for helping
contributors and for taking the time to review this work.</p>

  </div>
</div>



  <div class="after_post"><a href="http://gregoryszorc.com/blog/2013/07/29/mercurial-setup-wizard-for-firefox-development#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
 <a href="../4">« Previous Page</a>
  --  
 <a href="../6">Next Page »</a>

              </div>
              
          <div id="sidebar">
          <ul>
            <li>
              <h2>Categories</h2>
              <ul>
                <li><a href="/blog/category/clang">Clang</a></li>
                <li><a href="/blog/category/firefox">Firefox</a></li>
                <li><a href="/blog/category/git">Git</a></li>
                <li><a href="/blog/category/javascript">JavaScript</a></li>
                <li><a href="/blog/category/mercurial">Mercurial</a></li>
                <li><a href="/blog/category/mozilla">Mozilla</a></li>
                <li><a href="/blog/category/puppet">Puppet</a></li>
                <li><a href="/blog/category/python">Python</a></li>
                <li><a href="/blog/category/sync">Sync</a></li>
                <li><a href="/blog/category/browsers">browsers</a></li>
                <li><a href="/blog/category/build-system">build system</a></li>
                <li><a href="/blog/category/compilers">compilers</a></li>
                <li><a href="/blog/category/internet">internet</a></li>
                <li><a href="/blog/category/logging">logging</a></li>
                <li><a href="/blog/category/mach">mach</a></li>
                <li><a href="/blog/category/make">make</a></li>
                <li><a href="/blog/category/misc">misc</a></li>
                <li><a href="/blog/category/movies">movies</a></li>
                <li><a href="/blog/category/pymake">pymake</a></li>
                <li><a href="/blog/category/security">security</a></li>
                <li><a href="/blog/category/sysadmin">sysadmin</a></li>
                <li><a href="/blog/category/testing">testing</a></li>
              </ul>
            </li>
          </ul>
        </div>



              <div style="clear: both;">&nbsp;</div>
          </div>
        </div>
      </div>
      <div id="footer">
        
  <hr/>
  <p>Copyright (c) 2012 Gregory Szorc. All rights reserved. Design by <a href="http://www.freecsstemplates.org/"> CSS Templates</a>.</p>


      </div>
    </div>
  </body>
</html>





